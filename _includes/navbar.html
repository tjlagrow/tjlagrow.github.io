<nav class="navbar navbar-expand-md navbar-light" role="navigation">
  <a class="navbar-brand" href="{{ '/' | relative_url }}">Theodore J. LaGrow</a>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-main"
          aria-controls="navbar-main" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div id="navbar-main" class="navbar-collapse collapse">
    <ul class="nav navbar-nav mr-auto">
      {% for link in site.data.navbar %}
        {%- comment -%}
          Build href:
          - internal => prefix with baseurl using relative_url
          - external => use as-is, open in new tab
        {%- endcomment -%}
        {% assign href = link.url %}
        {% if link.external %}
          {% assign target = ' target="_blank" rel="noopener"' %}
        {% else %}
          {% assign href = link.url | relative_url %}
          {% assign target = '' %}
        {% endif %}

        {%- comment -%}
          Active state:
          - exact match
          - or "section active" when current page is inside that section (exclude "/" to avoid Home always active)
        {%- endcomment -%}
        {% assign is_active = false %}
        {% if page.url == link.url or page.url == link.url | append: 'index.html' %}
          {% assign is_active = true %}
        {% elsif link.url != '/' and page.url != '/' and page.url contains link.url %}
          {% assign is_active = true %}
        {% endif %}

        <li class="nav-item {% if is_active %}active{% endif %}">
          <a class="nav-link {% if is_active %}active{% endif %}" href="{{ href }}" {{ target }}
             {% if is_active %}aria-current="page"{% endif %}>
            {{ link.title }}
          </a>
        </li>
      {% endfor %}
    </ul>
  </div>
</nav>
